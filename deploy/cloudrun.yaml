apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: pyloto-corp
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/maxScale: "10"
    spec:
      containers:
        - image: gcr.io/PROJECT_ID/pyloto-corp:latest
          ports:
            - containerPort: 8080
          env:
            - name: ENVIRONMENT
              value: "production"
            - name: LOG_LEVEL
              value: "INFO"
            - name: DEDUPE_BACKEND
              value: "redis"
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: pyloto-redis-url
                  key: latest
            - name: WHATSAPP_VERIFY_TOKEN
              valueFrom:
                secretKeyRef:
                  name: pyloto-whatsapp-verify-token
                  key: latest
            - name: WHATSAPP_WEBHOOK_SECRET
              valueFrom:
                secretKeyRef:
                  name: pyloto-whatsapp-webhook-secret
                  key: latest
            - name: WHATSAPP_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  name: pyloto-whatsapp-access-token
                  key: latest
            - name: WHATSAPP_PHONE_NUMBER_ID
              valueFrom:
                secretKeyRef:
                  name: pyloto-whatsapp-phone-number-id
                  key: latest
